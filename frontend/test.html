<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–¢–µ—Å—Ç–æ–≤–∞—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }
        
        .container {
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            padding: 40px;
            max-width: 800px;
            width: 100%;
        }
        
        h1 {
            color: #333;
            margin-bottom: 10px;
            font-size: 2.5em;
            text-align: center;
        }
        
        .subtitle {
            color: #666;
            text-align: center;
            margin-bottom: 30px;
            font-size: 1.1em;
        }
        
        .section {
            margin-bottom: 30px;
            padding: 25px;
            background: #f8f9fa;
            border-radius: 15px;
            border-left: 5px solid #667eea;
        }
        
        .section h2 {
            color: #333;
            margin-bottom: 15px;
            font-size: 1.5em;
        }
        
        .info-box {
            background: #e9ecef;
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 15px;
            font-family: 'Courier New', monospace;
            font-size: 0.9em;
            overflow-x: auto;
        }
        
        .button-group {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
            margin-top: 20px;
        }
        
        button {
            padding: 15px 30px;
            border: none;
            border-radius: 10px;
            font-size: 1em;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            flex: 1;
            min-width: 200px;
        }
        
        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }
        
        .btn-secondary {
            background: #6c757d;
            color: white;
        }
        
        .btn-success {
            background: #28a745;
            color: white;
        }
        
        .btn-danger {
            background: #dc3545;
            color: white;
        }
        
        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.2);
        }
        
        button:active {
            transform: translateY(0);
        }
        
        .result-box {
            margin-top: 20px;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 10px;
            border: 2px dashed #dee2e6;
            min-height: 100px;
            font-family: 'Courier New', monospace;
            white-space: pre-wrap;
            word-wrap: break-word;
            max-height: 400px;
            overflow-y: auto;
        }
        
        .status {
            padding: 10px 20px;
            border-radius: 20px;
            font-weight: bold;
            margin-bottom: 15px;
            display: inline-block;
        }
        
        .status-success {
            background: #d4edda;
            color: #155724;
        }
        
        .status-error {
            background: #f8d7da;
            color: #721c24;
        }
        
        .form-group {
            margin-bottom: 15px;
        }
        
        label {
            display: block;
            margin-bottom: 5px;
            color: #333;
            font-weight: 500;
        }
        
        input {
            width: 100%;
            padding: 12px;
            border: 2px solid #dee2e6;
            border-radius: 8px;
            font-size: 1em;
            transition: border-color 0.3s ease;
        }
        
        input:focus {
            outline: none;
            border-color: #667eea;
        }
        
        .token-display {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 10px;
            margin-top: 10px;
            font-family: 'Courier New', monospace;
            font-size: 0.8em;
            word-break: break-all;
            max-height: 150px;
            overflow-y: auto;
        }
        
        .hidden {
            display: none;
        }
        
        @media (max-width: 768px) {
            .container {
                padding: 20px;
            }
            
            h1 {
                font-size: 2em;
            }
            
            button {
                min-width: 100%;
            }
            
            .button-group {
                flex-direction: column;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üîê –¢–µ—Å—Ç–æ–≤–∞—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è</h1>
        <p class="subtitle">–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–∏—Å—Ç–µ–º—ã –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ Telegram WebApp</p>
        
        <!-- –°–µ–∫—Ü–∏—è 1: –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Ç–µ–∫—É—â–µ–π –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ -->
        <div class="section">
            <h2>üìä –¢–µ–∫—É—â–∏–π —Å—Ç–∞—Ç—É—Å</h2>
            <div id="statusContainer">
                <div class="status" id="authStatus">–ù–µ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω</div>
            </div>
            <div class="info-box">
                <strong>API Endpoints:</strong><br>
                ‚Ä¢ POST /api/auth/telegram - Telegram –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è<br>
                ‚Ä¢ POST /api/auth/refresh - –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ç–æ–∫–µ–Ω–∞<br>
                ‚Ä¢ POST /api/auth/logout - –í—ã—Ö–æ–¥<br>
                ‚Ä¢ GET /api/auth/me - –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ<br>
                ‚Ä¢ GET /api/shop/check-owner/{id} - –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤–ª–∞–¥–µ–ª—å—Ü–∞ –º–∞–≥–∞–∑–∏–Ω–∞
            </div>
        </div>
        
        <!-- –°–µ–∫—Ü–∏—è 2: –¢–µ—Å—Ç–æ–≤–∞—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è -->
        <div class="section">
            <h2>üß™ –¢–µ—Å—Ç–æ–≤–∞—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è</h2>
            <p>–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —ç—Ç–∏ –∫–Ω–æ–ø–∫–∏ –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è —Ä–∞–∑–ª–∏—á–Ω—ã—Ö —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏:</p>
            
            <div class="form-group">
                <label for="businessId">Business ID (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ):</label>
                <input type="text" id="businessId" placeholder="–í–≤–µ–¥–∏—Ç–µ ID –º–∞–≥–∞–∑–∏–Ω–∞ –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø—Ä–∞–≤">
            </div>
            
            <div class="button-group">
                <button class="btn-primary" onclick="testTelegramAuth()">üîê –¢–µ—Å—Ç Telegram Auth</button>
                <button class="btn-secondary" onclick="testRefreshToken()">üîÑ –û–±–Ω–æ–≤–∏—Ç—å —Ç–æ–∫–µ–Ω</button>
                <button class="btn-success" onclick="testGetCurrentUser()">üë§ –ü–æ–ª—É—á–∏—Ç—å –¥–∞–Ω–Ω—ã–µ</button>
                <button class="btn-danger" onclick="testLogout()">üö™ –í—ã–π—Ç–∏</button>
            </div>
            
            <div class="form-group">
                <label>–¢–µ–∫—É—â–∏–π Access Token:</label>
                <div class="token-display" id="accessTokenDisplay">–ù–µ—Ç —Ç–æ–∫–µ–Ω–∞</div>
            </div>
            
            <div class="form-group">
                <label>–¢–µ–∫—É—â–∏–π Refresh Token:</label>
                <div class="token-display" id="refreshTokenDisplay">–ù–µ—Ç —Ç–æ–∫–µ–Ω–∞</div>
            </div>
        </div>
        
        <!-- –°–µ–∫—Ü–∏—è 3: –¢–µ—Å—Ç–æ–≤—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ -->
        <div class="section">
            <h2>üë• –¢–µ—Å—Ç–æ–≤—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏</h2>
            <p>–í—ã–±–µ—Ä–∏—Ç–µ —Ç–µ—Å—Ç–æ–≤–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –¥–ª—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏:</p>
            
            <div class="button-group">
                <button class="btn-primary" onclick="useTestUser('user')">üë§ –û–±—ã—á–Ω—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å</button>
                <button class="btn-success" onclick="useTestUser('shop_owner')">üè™ –í–ª–∞–¥–µ–ª–µ—Ü –º–∞–≥–∞–∑–∏–Ω–∞</button>
                <button class="btn-danger" onclick="useTestUser('admin')">üëë –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä</button>
            </div>
            
            <div class="info-box" id="currentTestUser">
                –¢–µ–∫—É—â–∏–π —Ç–µ—Å—Ç–æ–≤—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: –Ω–µ –≤—ã–±—Ä–∞–Ω
            </div>
        </div>
        
        <!-- –°–µ–∫—Ü–∏—è 4: –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∞–≤ -->
        <div class="section">
            <h2>üîí –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∞–≤ –¥–æ—Å—Ç—É–ø–∞</h2>
            <div class="button-group">
                <button class="btn-primary" onclick="checkShopOwner()">üè™ –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –≤–ª–∞–¥–µ–ª—å—Ü–∞ –º–∞–≥–∞–∑–∏–Ω–∞</button>
                <button class="btn-secondary" onclick="testProtectedEndpoint()">üõ°Ô∏è –¢–µ—Å—Ç –∑–∞—â–∏—â–µ–Ω–Ω–æ–≥–æ —ç–Ω–¥–ø–æ–∏–Ω—Ç–∞</button>
            </div>
        </div>
        
        <!-- –°–µ–∫—Ü–∏—è 5: –†–µ–∑—É–ª—å—Ç–∞—Ç—ã -->
        <div class="section">
            <h2>üìã –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –∑–∞–ø—Ä–æ—Å–æ–≤</h2>
            <div class="result-box" id="resultBox">
                –ó–¥–µ—Å—å –±—É–¥—É—Ç –æ—Ç–æ–±—Ä–∞–∂–∞—Ç—å—Å—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –∑–∞–ø—Ä–æ—Å–æ–≤...
            </div>
        </div>
    </div>

    <script>
        // –ë–∞–∑–æ–≤—ã–π URL API
        const API_BASE_URL = 'http://localhost:8080/api';
        
        // –¢–æ–∫–µ–Ω—ã
        let accessToken = localStorage.getItem('accessToken');
        let refreshToken = localStorage.getItem('refreshToken');
        let currentUser = JSON.parse(localStorage.getItem('currentUser') || 'null');
        
        // –¢–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
        const testUsers = {
            user: {
                telegram_id: 123456789,
                username: 'test_user',
                first_name: '–ò–≤–∞–Ω',
                last_name: '–¢–µ—Å—Ç–æ–≤—ã–π',
                language_code: 'ru',
                is_premium: false,
                role: 'user'
            },
            shop_owner: {
                telegram_id: 987654321,
                username: 'shop_owner',
                first_name: '–ü–µ—Ç—Ä',
                last_name: '–í–ª–∞–¥–µ–ª–µ—Ü',
                language_code: 'ru',
                is_premium: true,
                role: 'shop_owner',
                owned_shop_id: 'shop_123'
            },
            admin: {
                telegram_id: 555555555,
                username: 'admin_user',
                first_name: '–ê–¥–º–∏–Ω',
                last_name: '–°–∏—Å—Ç–µ–º–Ω—ã–π',
                language_code: 'ru',
                is_premium: true,
                role: 'admin'
            }
        };
        
        let currentTestUser = null;
        
        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è —Å—Ç–∞—Ç—É—Å–∞
        function updateStatus() {
            const authStatus = document.getElementById('authStatus');
            const accessTokenDisplay = document.getElementById('accessTokenDisplay');
            const refreshTokenDisplay = document.getElementById('refreshTokenDisplay');
            
            if (accessToken) {
                authStatus.textContent = '–ê–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω';
                authStatus.className = 'status status-success';
                
                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Å–æ–∫—Ä–∞—â–µ–Ω–Ω—ã–π —Ç–æ–∫–µ–Ω
                const shortAccessToken = accessToken.substring(0, 30) + '...';
                const shortRefreshToken = refreshToken ? refreshToken.substring(0, 30) + '...' : '–ù–µ—Ç —Ç–æ–∫–µ–Ω–∞';
                
                accessTokenDisplay.textContent = shortAccessToken;
                refreshTokenDisplay.textContent = shortRefreshToken;
                
                if (currentUser) {
                    document.getElementById('currentTestUser').textContent = 
                        `–¢–µ–∫—É—â–∏–π —Ç–µ—Å—Ç–æ–≤—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: ${currentUser.username} (${currentUser.role})`;
                }
            } else {
                authStatus.textContent = '–ù–µ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω';
                authStatus.className = 'status';
                accessTokenDisplay.textContent = '–ù–µ—Ç —Ç–æ–∫–µ–Ω–∞';
                refreshTokenDisplay.textContent = '–ù–µ—Ç —Ç–æ–∫–µ–Ω–∞';
                document.getElementById('currentTestUser').textContent = 
                    '–¢–µ–∫—É—â–∏–π —Ç–µ—Å—Ç–æ–≤—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: –Ω–µ –≤—ã–±—Ä–∞–Ω';
            }
        }
        
        // –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
        function showResult(message, isError = false) {
            const resultBox = document.getElementById('resultBox');
            const timestamp = new Date().toLocaleTimeString();
            const result = `[${timestamp}] ${isError ? '‚ùå –û–®–ò–ë–ö–ê:' : '‚úÖ –£–°–ü–ï–•:'} ${message}`;
            
            resultBox.textContent = result + '\n' + resultBox.textContent;
            
            if (isError) {
                resultBox.style.borderColor = '#dc3545';
                setTimeout(() => {
                    resultBox.style.borderColor = '#dee2e6';
                }, 2000);
            } else {
                resultBox.style.borderColor = '#28a745';
                setTimeout(() => {
                    resultBox.style.borderColor = '#dee2e6';
                }, 2000);
            }
        }
        
        // –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Ç–µ—Å—Ç–æ–≤–æ–≥–æ initData
        function generateTestInitData(userData) {
            // –í —Ä–µ–∞–ª—å–Ω–æ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏ –∑–¥–µ—Å—å –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –ø—Ä–∞–≤–∏–ª—å–Ω–∞—è –ø–æ–¥–ø–∏—Å—å
            // –î–ª—è —Ç–µ—Å—Ç–æ–≤ –∏—Å–ø–æ–ª—å–∑—É–µ–º —É–ø—Ä–æ—â–µ–Ω–Ω—ã–π –≤–∞—Ä–∏–∞–Ω—Ç
            const userString = JSON.stringify({
                id: userData.telegram_id,
                username: userData.username,
                first_name: userData.first_name,
                last_name: userData.last_name,
                language_code: userData.language_code,
                is_premium: userData.is_premium
            });
            
            return `user=${encodeURIComponent(userString)}&auth_date=${Math.floor(Date.now() / 1000)}&hash=test_signature`;
        }
        
        // –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Ç–µ—Å—Ç–æ–≤–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
        function useTestUser(userType) {
            currentTestUser = testUsers[userType];
            showResult(`–í—ã–±—Ä–∞–Ω —Ç–µ—Å—Ç–æ–≤—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: ${currentTestUser.username} (${currentTestUser.role})`);
            updateStatus();
        }
        
        // –¢–µ—Å—Ç Telegram –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
        async function testTelegramAuth() {
            if (!currentTestUser) {
                showResult('–°–Ω–∞—á–∞–ª–∞ –≤—ã–±–µ—Ä–∏—Ç–µ —Ç–µ—Å—Ç–æ–≤–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è!', true);
                return;
            }
            
            const businessId = document.getElementById('businessId').value;
            
            try {
                const initData = generateTestInitData(currentTestUser);
                
                const response = await fetch(`${API_BASE_URL}/auth/telegram`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        initData: initData,
                        businessId: businessId || null
                    })
                });
                
                const data = await response.json();
                
                if (response.ok) {
                    accessToken = data.access_token;
                    refreshToken = data.refresh_token;
                    currentUser = data.user;
                    
                    // –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤ localStorage
                    localStorage.setItem('accessToken', accessToken);
                    localStorage.setItem('refreshToken', refreshToken);
                    localStorage.setItem('currentUser', JSON.stringify(currentUser));
                    
                    showResult(`–£—Å–ø–µ—à–Ω–∞—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è! –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: ${currentUser.username}, –†–æ–ª—å: ${currentUser.role}`);
                    updateStatus();
                } else {
                    showResult(`–û—à–∏–±–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏: ${data.error}`, true);
                }
            } catch (error) {
                showResult(`–û—à–∏–±–∫–∞ —Å–µ—Ç–∏: ${error.message}`, true);
            }
        }
        
        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ç–æ–∫–µ–Ω–∞
        async function testRefreshToken() {
            if (!refreshToken) {
                showResult('–ù–µ—Ç refresh —Ç–æ–∫–µ–Ω–∞ –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è!', true);
                return;
            }
            
            try {
                const response = await fetch(`${API_BASE_URL}/auth/refresh`, {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${refreshToken}`
                    }
                });
                
                const data = await response.json();
                
                if (response.ok) {
                    accessToken = data.access_token;
                    currentUser = data.user;
                    
                    localStorage.setItem('accessToken', accessToken);
                    localStorage.setItem('currentUser', JSON.stringify(currentUser));
                    
                    showResult('–¢–æ–∫–µ–Ω —É—Å–ø–µ—à–Ω–æ –æ–±–Ω–æ–≤–ª–µ–Ω!');
                    updateStatus();
                } else {
                    showResult(`–û—à–∏–±–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Ç–æ–∫–µ–Ω–∞: ${data.error}`, true);
                }
            } catch (error) {
                showResult(`–û—à–∏–±–∫–∞ —Å–µ—Ç–∏: ${error.message}`, true);
            }
        }
        
        // –ü–æ–ª—É—á–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö —Ç–µ–∫—É—â–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
        async function testGetCurrentUser() {
            if (!accessToken) {
                showResult('–°–Ω–∞—á–∞–ª–∞ –∞–≤—Ç–æ—Ä–∏–∑—É–π—Ç–µ—Å—å!', true);
                return;
            }
            
            try {
                const response = await fetch(`${API_BASE_URL}/auth/me`, {
                    method: 'GET',
                    headers: {
                        'Authorization': `Bearer ${accessToken}`
                    }
                });
                
                const data = await response.json();
                
                if (response.ok) {
                    showResult(`–î–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è: ${JSON.stringify(data.user, null, 2)}`);
                } else {
                    showResult(`–û—à–∏–±–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö: ${data.error}`, true);
                }
            } catch (error) {
                showResult(`–û—à–∏–±–∫–∞ —Å–µ—Ç–∏: ${error.message}`, true);
            }
        }
        
        // –í—ã—Ö–æ–¥
        async function testLogout() {
            if (!accessToken) {
                showResult('–í—ã –Ω–µ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω—ã!', true);
                return;
            }
            
            try {
                const response = await fetch(`${API_BASE_URL}/auth/logout`, {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${accessToken}`
                    }
                });
                
                if (response.ok) {
                    // –û—á–∏—â–∞–µ–º —Ç–æ–∫–µ–Ω—ã
                    accessToken = null;
                    refreshToken = null;
                    currentUser = null;
                    currentTestUser = null;
                    
                    localStorage.removeItem('accessToken');
                    localStorage.removeItem('refreshToken');
                                        localStorage.removeItem('currentUser');
                    
                    showResult('–£—Å–ø–µ—à–Ω—ã–π –≤—ã—Ö–æ–¥ –∏–∑ —Å–∏—Å—Ç–µ–º—ã');
                    updateStatus();
                } else {
                    const data = await response.json();
                    showResult(`–û—à–∏–±–∫–∞ –≤—ã—Ö–æ–¥–∞: ${data.error}`, true);
                }
            } catch (error) {
                showResult(`–û—à–∏–±–∫–∞ —Å–µ—Ç–∏: ${error.message}`, true);
            }
        }
        
        // –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤–ª–∞–¥–µ–ª—å—Ü–∞ –º–∞–≥–∞–∑–∏–Ω–∞
        async function checkShopOwner() {
            if (!accessToken) {
                showResult('–°–Ω–∞—á–∞–ª–∞ –∞–≤—Ç–æ—Ä–∏–∑—É–π—Ç–µ—Å—å!', true);
                return;
            }
            
            const businessId = document.getElementById('businessId').value || 'shop_123';
            
            try {
                const response = await fetch(`${API_BASE_URL}/shop/check-owner/${businessId}`, {
                    method: 'GET',
                    headers: {
                        'Authorization': `Bearer ${accessToken}`
                    }
                });
                
                const data = await response.json();
                
                if (response.ok) {
                    if (data.is_owner) {
                        showResult(`‚úÖ –í—ã —è–≤–ª—è–µ—Ç–µ—Å—å –≤–ª–∞–¥–µ–ª—å—Ü–µ–º –º–∞–≥–∞–∑–∏–Ω–∞ ${businessId}`);
                    } else {
                        showResult(`‚ùå –í—ã –ù–ï —è–≤–ª—è–µ—Ç–µ—Å—å –≤–ª–∞–¥–µ–ª—å—Ü–µ–º –º–∞–≥–∞–∑–∏–Ω–∞ ${businessId}`);
                    }
                } else {
                    showResult(`–û—à–∏–±–∫–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø—Ä–∞–≤: ${data.error}`, true);
                }
            } catch (error) {
                showResult(`–û—à–∏–±–∫–∞ —Å–µ—Ç–∏: ${error.message}`, true);
            }
        }
        
        // –¢–µ—Å—Ç –∑–∞—â–∏—â–µ–Ω–Ω–æ–≥–æ —ç–Ω–¥–ø–æ–∏–Ω—Ç–∞
        async function testProtectedEndpoint() {
            if (!accessToken) {
                showResult('–°–Ω–∞—á–∞–ª–∞ –∞–≤—Ç–æ—Ä–∏–∑—É–π—Ç–µ—Å—å!', true);
                return;
            }
            
            try {
                // –¢–µ—Å—Ç–∏—Ä—É–µ–º –ø–æ–ª—É—á–µ–Ω–∏–µ –∫–∞—Ä—Ç–æ—á–µ–∫ (–ø—É–±–ª–∏—á–Ω—ã–π —ç–Ω–¥–ø–æ–∏–Ω—Ç)
                const response = await fetch(`${API_BASE_URL}/cards`, {
                    method: 'GET',
                    headers: {
                        'Authorization': `Bearer ${accessToken}`
                    }
                });
                
                const data = await response.json();
                
                if (response.ok) {
                    showResult(`‚úÖ –£—Å–ø–µ—à–Ω—ã–π –¥–æ—Å—Ç—É–ø –∫ –∑–∞—â–∏—â–µ–Ω–Ω–æ–º—É —ç–Ω–¥–ø–æ–∏–Ω—Ç—É. –ü–æ–ª—É—á–µ–Ω–æ –∫–∞—Ä—Ç–æ—á–µ–∫: ${data.length || 0}`);
                } else {
                    showResult(`‚ùå –û—à–∏–±–∫–∞ –¥–æ—Å—Ç—É–ø–∞: ${data.error}`, true);
                }
            } catch (error) {
                showResult(`–û—à–∏–±–∫–∞ —Å–µ—Ç–∏: ${error.message}`, true);
            }
        }
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        document.addEventListener('DOMContentLoaded', function() {
            updateStatus();
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –µ—Å—Ç—å –ª–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã–µ —Ç–æ–∫–µ–Ω—ã
            if (accessToken) {
                showResult('–ù–∞–π–¥–µ–Ω—ã —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã–µ —Ç–æ–∫–µ–Ω—ã. –í—ã –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω—ã.');
                
                // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≤—ã–±–∏—Ä–∞–µ–º —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–µ–≥–æ —Ç–µ—Å—Ç–æ–≤–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
                if (currentUser) {
                    const userType = Object.keys(testUsers).find(
                        key => testUsers[key].telegram_id === currentUser.telegram_id
                    );
                    if (userType) {
                        currentTestUser = testUsers[userType];
                    }
                }
            } else {
                showResult('–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å! –í—ã–±–µ—Ä–∏—Ç–µ —Ç–µ—Å—Ç–æ–≤–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏ –Ω–∞–∂–º–∏—Ç–µ "–¢–µ—Å—Ç Telegram Auth"');
            }
            
            // –î–æ–±–∞–≤–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –¥–ª—è –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–∏ —Ç–æ–∫–µ–Ω–æ–≤
            document.getElementById('accessTokenDisplay').addEventListener('click', function() {
                if (accessToken) {
                    navigator.clipboard.writeText(accessToken).then(() => {
                        alert('Access Token —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω –≤ –±—É—Ñ–µ—Ä –æ–±–º–µ–Ω–∞!');
                    });
                }
            });
            
            document.getElementById('refreshTokenDisplay').addEventListener('click', function() {
                if (refreshToken) {
                    navigator.clipboard.writeText(refreshToken).then(() => {
                        alert('Refresh Token —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω –≤ –±—É—Ñ–µ—Ä –æ–±–º–µ–Ω–∞!');
                    });
                }
            });
            
            // –î–æ–±–∞–≤–ª—è–µ–º –ø–æ–¥—Å–∫–∞–∑–∫–∏ –¥–ª—è –ø–æ–ª–µ–π –≤–≤–æ–¥–∞
            document.getElementById('businessId').addEventListener('focus', function() {
                this.placeholder = '–ù–∞–ø—Ä–∏–º–µ—Ä: shop_123, business_456';
            });
            
            document.getElementById('businessId').addEventListener('blur', function() {
                this.placeholder = '–í–≤–µ–¥–∏—Ç–µ ID –º–∞–≥–∞–∑–∏–Ω–∞ –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø—Ä–∞–≤';
            });
        });
        
        // –ì–ª–æ–±–∞–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –¥–ª—è –∫–Ω–æ–ø–æ–∫
        window.testTelegramAuth = testTelegramAuth;
        window.testRefreshToken = testRefreshToken;
        window.testGetCurrentUser = testGetCurrentUser;
        window.testLogout = testLogout;
        window.useTestUser = useTestUser;
        window.checkShopOwner = checkShopOwner;
        window.testProtectedEndpoint = testProtectedEndpoint;
    </script>
</body>
</html>